<!DOCTYPE html>

<!-- Test: Typical fullscreen usage; autoload an image and overlay. -->

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <!-- CSS debug start -->
    <link rel="stylesheet" type="text/css" href="../src/css/base.css" />
    <link rel="stylesheet" type="text/css" href="../src/css/ui/toolbar.css" />
    <link rel="stylesheet" type="text/css" href="../src/css/ui/menu.css" />
    <link rel="stylesheet" type="text/css" href="../src/css/ui/dialog.css" />
    <link rel="stylesheet" type="text/css" href="../src/css/utilities/nojs.css" />
    <link rel="stylesheet" type="text/css" href="../src/css/utilities/unsupported.css" />
    <link rel="stylesheet" type="text/css" href="../src/css/viewer/viewer.css" />
    <!-- CSS debug end -->

    <!-- JS debug start -->
    <script type="text/javascript" src="../src/js/data/sample-image.js"></script>
    <script type="text/javascript" src="../src/js/data/talairach-atlas-image.js"></script>
    <script type="text/javascript" src="../src/js/data/talairach-atlas.js"></script>

    <script type="text/javascript" src="../lib/base64-binary.js"></script>
    <script type="text/javascript" src="../lib/bowser.js"></script>
    <script type="text/javascript" src="../lib/daikon.js"></script>
    <script type="text/javascript" src="../lib/nifti-reader.js"></script>
    <script type="text/javascript" src="../lib/jquery.js"></script>
    <script type="text/javascript" src="../lib/numerics.js"></script>
    <script type="text/javascript" src="../lib/pako-inflate.js"></script>
    <script type="text/javascript" src="../lib/gl-matrix.js"></script>
    <script type="text/javascript" src="../lib/gifti-reader.js"></script>
    <script type="text/javascript" src="../lib/GLU.js"></script>

    <script type="text/javascript" src="../src/js/constants.js"></script>

    <script type="text/javascript" src="../src/js/utilities/array-utils.js"></script>
    <script type="text/javascript" src="../src/js/utilities/math-utils.js"></script>
    <script type="text/javascript" src="../src/js/utilities/object-utils.js"></script>
    <script type="text/javascript" src="../src/js/utilities/platform-utils.js"></script>
    <script type="text/javascript" src="../src/js/utilities/string-utils.js"></script>
    <script type="text/javascript" src="../src/js/utilities/url-utils.js"></script>

    <script type="text/javascript" src="../src/js/core/coordinate.js"></script>
    <script type="text/javascript" src="../src/js/core/point.js"></script>

    <script type="text/javascript" src="../src/js/volume/header.js"></script>
    <script type="text/javascript" src="../src/js/volume/imagedata.js"></script>
    <script type="text/javascript" src="../src/js/volume/imagedescription.js"></script>
    <script type="text/javascript" src="../src/js/volume/imagedimensions.js"></script>
    <script type="text/javascript" src="../src/js/volume/imagerange.js"></script>
    <script type="text/javascript" src="../src/js/volume/imagetype.js"></script>
    <script type="text/javascript" src="../src/js/volume/nifti/header-nifti.js"></script>
    <script type="text/javascript" src="../src/js/volume/dicom/header-dicom.js"></script>
    <script type="text/javascript" src="../src/js/volume/orientation.js"></script>
    <script type="text/javascript" src="../src/js/volume/transform.js"></script>
    <script type="text/javascript" src="../src/js/volume/volume.js"></script>
    <script type="text/javascript" src="../src/js/volume/voxeldimensions.js"></script>
    <script type="text/javascript" src="../src/js/volume/voxelvalue.js"></script>

    <script type="text/javascript" src="../src/js/surface/surface.js"></script>
    <script type="text/javascript" src="../src/js/surface/surface-gifti.js"></script>
    <script type="text/javascript" src="../src/js/surface/surface-mango.js"></script>
    <script type="text/javascript" src="../src/js/surface/surface-vtk.js"></script>

    <script type="text/javascript" src="../src/js/ui/dialog.js"></script>
    <script type="text/javascript" src="../src/js/ui/menu.js"></script>
    <script type="text/javascript" src="../src/js/ui/menuitem.js"></script>
    <script type="text/javascript" src="../src/js/ui/menuitemcheckbox.js"></script>
    <script type="text/javascript" src="../src/js/ui/menuitemradiobutton.js"></script>
    <script type="text/javascript" src="../src/js/ui/menuitemfilechooser.js"></script>
    <script type="text/javascript" src="../src/js/ui/menuitemrange.js"></script>
    <script type="text/javascript" src="../src/js/ui/menuitemslider.js"></script>
    <script type="text/javascript" src="../src/js/ui/menuitemspacer.js"></script>
    <script type="text/javascript" src="../src/js/ui/toolbar.js"></script>

    <script type="text/javascript" src="../src/js/viewer/atlas.js"></script>
    <script type="text/javascript" src="../src/js/viewer/colortable.js"></script>
    <script type="text/javascript" src="../src/js/viewer/display.js"></script>
    <script type="text/javascript" src="../src/js/viewer/preferences.js"></script>
    <script type="text/javascript" src="../src/js/viewer/screenslice.js"></script>
    <script type="text/javascript" src="../src/js/viewer/screensurface.js"></script>
    <script type="text/javascript" src="../src/js/viewer/screenvol.js"></script>
    <script type="text/javascript" src="../src/js/viewer/viewer.js"></script>

    <script type="text/javascript" src="../src/js/main.js"></script>
    <!-- JS debug end -->

    <script type="text/javascript">
      /* DO NOT EDIT (start) -- papayaLoadableImages is generated by papaya-builder and is here for debugging purposes only */
      var papayaLoadableImages = [
        { nicename: "Sample Image", name: "sample_image", encode: "sample_image" },
        { nicename: "Atlas", name: "Talairach_labels_1mm", encode: "Talairach_labels_1mm", hide: true },
      ];
      /* DO NOT EDIT (end) */

      var params = [];
      params["encodedImages"] = [sample_image]; // from src/js/data/sample-image.js
      // params["encodedImages"] = ["sample_image"];  // or this method will dereference variable name
      params["atlas"] = ["Talairach_labels_1mm"];

      function getViewer() {
        return papayaContainers[0].viewer;
      }

      function getConstantDimension(plane) {
        switch (plane) {
          case "axial":
            return ["z", ["x", "y"]];
          case "sagittal":
            return ["x", ["y", "z"]];
          case "coronal":
            return ["y", ["x", "z"]];
          default:
            throw new Error("Unknown plane: " + plane);
        }
      }

      function twoWayBindCrosshairs(options) {
        const viewer = getViewer();
        options.canvas.addEventListener("click", function (event) {
          const rect = options.canvas.getBoundingClientRect();
          const clickX = event.clientX - rect.left;
          const clickY = event.clientY - rect.top;

          viewer.withSlice(options, (slice) => {
            let x = (clickX - slice.finalTransform[0][2]) / slice.finalTransform[0][0] - 0.5;
            let y = (clickY - slice.finalTransform[1][2]) / slice.finalTransform[1][1] - 0.5;
            const [C, [X, Y]] = getConstantDimension(options.slice);
            const currentCoord = viewer.currentCoord;
            currentCoord[X] = x;
            currentCoord[Y] = y;
          });

          viewer.viewsChanged(true);
        });
      }

      function createView({ width = 300, height, slice, canvas, crosshairs = true, volume }) {
        if (typeof canvas === "string") {
          canvas = document.getElementById(canvas);
        } else {
          canvas = document.createElement("canvas");
          canvas = canvas || Math.random().toString(36).substring(7);
          canvas.width = width;
          canvas.height = height || width;
          document.getElementById("views").appendChild(canvas);
        }

        const viewOptions = {
          slice,
          canvas,
          crosshairs,
          volume,
        };
        const viewer = getViewer();
        const cleanup = viewer.onDrawViewer(() => {
          viewer.drawSliceToCanvas(viewOptions);
        });

        if (viewOptions.crosshairs) {
          twoWayBindCrosshairs(viewOptions);
        }
      }

      $(document).ready(function () {
        const axialOptions = {
          slice: "axial",
          width: 300,
          crosshairs: true,
          volume: { 0: { alpha: 1.0 } },
        };

        const coronalOptions = {
          slice: "coronal",
          width: 300,
          crosshairs: true,
          volume: { 0: { alpha: 0.75 } },
        };

        const sagittalOptions = {
          slice: "sagittal",
          width: 300,
          crosshairs: true,
          volume: { 0: { alpha: 0.25 } },
        };

        params["loadingComplete"] = function () {
          createView(axialOptions);
          createView(coronalOptions);
          createView(axialOptions);
          createView(coronalOptions);
          createView(coronalOptions);
          createView(coronalOptions);
          createView(sagittalOptions);
          createView(axialOptions);
          createView(sagittalOptions);
          createView(axialOptions);
          createView(sagittalOptions);
          createView(sagittalOptions);
        };
      });
    </script>

    <title>BrainGraph Views</title>
  </head>

  <body>
    <div style="display: flex">
      <div style="width: 600px">
        <div class="papaya" data-params="params" style=""></div>
      </div>
      <div style="margin: 8px; line-height: 0" id="views"></div>
    </div>
  </body>
</html>
